user {{ env.attr['nginx']['user'] }};
worker_processes  {{ env.attr['nginx']['worker_processes'] }};
 
error_log  {{ env.attr['nginx']['log_dir'] }}/error.log;
pid        /var/run/nginx.pid;
 
events {
	worker_connections  {{ env.attr['nginx']['worker_connections'] }};
	{% if env.attr['nginx']['event_model'] %}use {{ env.attr['nginx']['event_model'] }};{% endif %}
}
 
http {
	include       {{ env.attr['nginx']['dir'] }}/mime.types;
	default_type  application/octet-stream;

	access_log	{{ env.attr['nginx']['log_dir'] }}/access.log;

	sendfile on;
	tcp_nopush on;
	tcp_nodelay on;

	{% if env.attr['nginx']['keepalive'] == "on" %}
	keepalive_timeout  {{ env.attr['nginx']['keepalive_timeout'] }};
	{% endif %}
 
	gzip  {{ env.attr['nginx']['gzip'] }};
	{% if env.attr['nginx']['gzip'] == "on" %}
		gzip_http_version {{ env.attr['nginx']['gzip_http_version'] }};
		gzip_comp_level {{ env.attr['nginx']['gzip_comp_level'] }};
		gzip_proxied {{ env.attr['nginx']['gzip_proxied'] }};
		gzip_types {{ " ".join(env.attr['nginx']['gzip_types']) }};
	{% endif %}
 
	{% if env.attr['nginx']['server_names_hash_max_size'] %}server_names_hash_max_size {{ env.attr['nginx']['server_names_hash_max_size'] }};{% endif %}
	{% if env.attr['nginx']['server_names_hash_bucket_size'] %}server_names_hash_bucket_size {{ env.attr['nginx']['server_names_hash_bucket_size'] }};{% endif %}

	include {{ env.attr['nginx']['dir'] }}/conf.d/*.conf;
	include {{ env.attr['nginx']['dir'] }}/sites-enabled/*;
}
